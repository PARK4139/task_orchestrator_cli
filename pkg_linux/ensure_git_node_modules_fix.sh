#!/bin/bash

echo "🔧 ensure_ 방식: Git node_modules 문제 완전 근절..."
echo "================================================"

# 1️⃣ 현재 Git 상태 분석
echo "📊 현재 Git 상태 분석..."
cd /c/Users/wjdgn/Downloads/pk_system

# 2️⃣ .gitignore 강화
echo "🛡️ .gitignore 강화 설정..."
cat > .gitignore << 'EOF'
# Node.js - 절대 추가하지 않음
**/node_modules/
node_modules/
*/node_modules/
services/**/node_modules/

# Next.js
**/.next/
.next/
*/.next/

# Build outputs
**/build/
**/dist/
**/out/

# Logs
**/*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
build_attempts_*.log

# Environment
**/.env
**/.env.local
**/.env.*.local

# IDE
.vscode/
.idea/
**/.vscode/
**/.idea/

# OS
.DS_Store
Thumbs.db
**/.DS_Store
**/Thumbs.db

# Temporary Docker files
Dockerfile.attempt*
Dockerfile.debug
**/Dockerfile.attempt*
**/Dockerfile.debug

#________________________________________________ weired
nul
EOF

# 3️⃣ Git 캐시 완전 초기화
echo "🧹 Git 캐시 완전 정리..."
git rm -r --cached . 2>/dev/null || echo "캐시 정리 시도 완료"

# 4️⃣ 특정 파일들만 선택적 추가
echo "📦 중요 파일들만 선택적 추가..."

# .gitignore 먼저 추가
git add .gitignore

# 프로젝트 루트 파일들
git add *.md 2>/dev/null || true
git add *.py 2>/dev/null || true
git add *.toml 2>/dev/null || true
git add *.yaml 2>/dev/null || true
git add *.yml 2>/dev/null || true

# 프론트엔드 설정 파일들만 (node_modules 제외)
git add services/smart_person_ai/service_official_home/frontend/package.json 2>/dev/null || true
git add services/smart_person_ai/service_official_home/frontend/package-lock.json 2>/dev/null || true
git add services/smart_person_ai/service_official_home/frontend/next.config.js 2>/dev/null || true
git add services/smart_person_ai/service_official_home/frontend/tsconfig.json 2>/dev/null || true
git add services/smart_person_ai/service_official_home/frontend/tailwind.config.js 2>/dev/null || true

# Dockerfile들
git add services/smart_person_ai/service_official_home/frontend/Dockerfile 2>/dev/null || true
git add services/smart_person_ai/service_official_home/frontend/Dockerfile.dev 2>/dev/null || true
git add services/smart_person_ai/service_official_home/frontend/.dockerignore 2>/dev/null || true

# 소스 코드들
git add services/smart_person_ai/service_official_home/frontend/app/ 2>/dev/null || true
git add services/smart_person_ai/service_official_home/frontend/components/ 2>/dev/null || true
git add services/smart_person_ai/service_official_home/frontend/public/ 2>/dev/null || true

# ensure_ 스크립트들
git add services/smart_person_ai/service_official_home/frontend/ensure_*.sh 2>/dev/null || true
git add services/smart_person_ai/service_official_home/frontend/fix_build_issue.sh 2>/dev/null || true

# 기타 중요 설정 파일들
git add services/smart_person_ai/service_official_home/*.md 2>/dev/null || true
git add services/smart_person_ai/service_official_home/*.yml 2>/dev/null || true
git add services/smart_person_ai/service_official_home/*.yaml 2>/dev/null || true

echo ""
echo "✅ 선택적 파일 추가 완료!"
echo "📊 추가된 파일 목록:"
git status --porcelain

echo ""
echo "🎯 이제 안전하게 커밋 가능합니다!"
EOF 
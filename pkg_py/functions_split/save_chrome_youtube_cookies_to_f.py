import os
from pkg_py.functions_split.ensure_printed import ensure_printed


def save_chrome_youtube_cookies_to_f():
    """
    Chrome ë¸Œë¼ìš°ì €ì—ì„œ YouTube ì¿ í‚¤ë¥¼ ì¶”ì¶œí•˜ì—¬ íŒŒì¼ë¡œ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
    
    Returns:
        bool: ì¿ í‚¤ ì €ì¥ ì„±ê³µ ì—¬ë¶€
    """
    import browser_cookie3
    from pkg_py.system_object.files import F_YOUTUBE_COOKIES_TXT

    try:
        # Chromeì—ì„œ YouTube ì¿ í‚¤ ê°€ì ¸ì˜¤ê¸°
        cj = browser_cookie3.chrome(domain_name=".youtube.com")
        
        # ì¿ í‚¤ íŒŒì¼ ìƒì„±
        with open(file=F_YOUTUBE_COOKIES_TXT, mode="w", encoding='utf-8') as f:
            # Netscape í˜•ì‹ í—¤ë” ì¶”ê°€
            f.write("# Netscape HTTP Cookie File\n")
            f.write("# This file is generated by yt-dlp. Do not edit.\n\n")
            
                    # ì¿ í‚¤ ë°ì´í„° ì‘ì„±
        for cookie in cj:
            # ë§Œë£Œ ì‹œê°„ì´ Noneì´ë©´ 0ìœ¼ë¡œ ì„¤ì •
            expires = cookie.expires if cookie.expires else 0
            # secure í”Œë˜ê·¸ ì„¤ì • (HTTPS ì¿ í‚¤ì¸ ê²½ìš°)
            secure = "TRUE" if cookie.secure else "FALSE"
            f.write(f"{cookie.domain}\tTRUE\t{cookie.path}\t{secure}\t{expires}\t{cookie.name}\t{cookie.value}\n")
        
        ensure_printed(f"âœ… YouTube ì¿ í‚¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: {F_YOUTUBE_COOKIES_TXT}", print_color="green")
        ensure_printed(f"ğŸ“Š ì €ì¥ëœ ì¿ í‚¤ ê°œìˆ˜: {len(list(cj))}", print_color="cyan")
        return True
        
    except ImportError:
        ensure_printed("âŒ browser_cookie3 ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.", print_color="red")
        ensure_printed("ğŸ’¡ ì„¤ì¹˜ ë°©ë²•: pip install browser-cookie3", print_color="yellow")
        ensure_printed("ğŸ’¡ ë˜ëŠ”: uv add browser-cookie3", print_color="yellow")
        return False
    except Exception as e:
        ensure_printed(f"âŒ ì¿ í‚¤ ì €ì¥ ì‹¤íŒ¨: {e}", print_color="red")
        return False
